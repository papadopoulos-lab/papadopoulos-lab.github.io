{
  "hash": "1c80edbcfca839284e248beb1136c050",
  "result": {
    "markdown": "---\ntitle: \"Multivariate imputation by chained equations (MICE) with interaction terms\"\ndescription: |\n  Examining how MICE works with interaction terms.\nauthor:\n  - name: \"Richard Aubrey White\"\n    url: https://www.rwhite.no\n    orcid: 0000-0002-6747-1726\ndate: 2023-04-20\ntitle-block-banner: \"#b8e2f2\"\neditor_options: \n  chunk_output_type: console\n---\n\n\nWe simulate a dataset where it is not harmful to be male nor a smoker (coefficient = 0), but the interaction of the two is very harmful (coefficient = 5).\n\nWe then set the outcome to missing for 70% of the males and 70% of the smokers, and run the following analyses:\n\n- Complete case analysis\n- Blindly imputed analysis (using MICE)\n- Imputed analysis (using MICE) where males and females were imputed separately.\n\nWe repeat this for multiple datasets with various sample sizes, to see how the imputation strategies are affected by the size of the dataset.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(data.table)\nlibrary(magrittr)\nlibrary(ggplot2)\n\nsim_function <- function(data, argset){\n  data <- data.table(id = 1:argset$n)\n  \n  data[, is_male := rbinom(.N, 1, 0.5)]\n  data[, is_smoker := rbinom(.N, 1, 0.5)]\n  data[, lung_function := -1 + 0 * is_male + 0 * is_smoker + 5 * is_male * is_smoker + rnorm(.N, sd = 2)]\n  \n  data_missing <- copy(data)\n  data_missing[is_male==1 & runif(.N)<0.7, lung_function := NA]\n  data_missing[is_smoker==1 & runif(.N)<0.7, lung_function := NA]\n  \n  # complete case analysis\n  coef_complete_case <- coef(summary(lm(lung_function ~ is_male*is_smoker, data = data_missing)))[,1]\n  \n  # we impute the data blindly\n  data_imputed <- mice::mice(data_missing, print=F, m = 20)\n  fit_imputed <- with(data_imputed, lm(lung_function ~ is_male*is_smoker))\n  coef_imputed_blindly <- mice::pool(fit_imputed)$pooled$estimate\n  \n  # we impute the data separately for males and females\n  data_imputed_male <- mice::mice(data_missing[is_male==1], print=F, m = 20)\n  data_imputed_female <- mice::mice(data_missing[is_male==0], print=F, m = 20)\n  data_imputed_sex_specific <- mice:::rbind.mids(data_imputed_male, data_imputed_female)\n  fit_imputed <- with(data_imputed_sex_specific, lm(lung_function ~ is_male*is_smoker))\n  coef_imputed_separately <- mice::pool(fit_imputed)$pooled$estimate\n  \n  retval <- data.table(\n    var = names(coef_complete_case),\n    coef_complete_case,\n    coef_imputed_blindly,\n    coef_imputed_separately,\n    n = argset$n\n  )\n  return(retval)\n}\n\np <- plnr::Plan$new()\nfor(n in c(100, 500, 1000, 2000, 4000)) for(i in 1:100){\n  p$add_argset(\n    name = uuid::UUIDgenerate(),\n    n=n,\n    i=i\n  )\n}\np$apply_action_fn_to_all_argsets(sim_function)\nset.seed(1234)\nresults <- p$run_all()\nresults <- rbindlist(results)\n\nresults[var == \"is_male:is_smoker\", .(\n  coef_complete_case = round(mean(coef_complete_case), 2),\n  coef_imputed_blindly = round(mean(coef_imputed_blindly), 2),\n  coef_imputed_separately = round(mean(coef_imputed_separately), 2)\n), keyby=.(n)] %>% \n  print()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n      n coef_complete_case coef_imputed_blindly coef_imputed_separately\n1:  100               5.06                 1.33                    2.60\n2:  500               4.97                 3.56                    4.89\n3: 1000               5.10                 4.49                    5.12\n4: 2000               5.03                 4.97                    5.09\n5: 4000               5.05                 5.09                    5.09\n```\n:::\n:::\n\n\nWe can see that (in this simple example) complete case analysis correctly captured the interaction's coefficient of 5.\n\nMore interesting is that with lower sample sizes, imputing males/females separately performed better than imputing blindly, however, once the sample size became sufficient then there was little difference between the two methods.\n\nThe code used to impute the data separately for males and females:\n\n```\ndata_imputed_male <- mice::mice(data_missing[is_male==1], print=F, m = 20)\ndata_imputed_female <- mice::mice(data_missing[is_male==0], print=F, m = 20)\ndata_imputed_sex_specific <- mice:::rbind.mids(data_imputed_male, data_imputed_female)\n```\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}